<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Cyrus Elahi">
<meta name="dcterms.date" content="2024-12-01">

<title>Template for Writing Scientific Papers (made easy) – thoughts</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">thoughts</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">Cyrus Elahi</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Template for Writing Scientific Papers (made easy)</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">writing</div>
                <div class="quarto-category">medical students</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Cyrus Elahi </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 1, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introduction-3-4-paragraphs-usually-4" class="level2">
<h2 class="anchored" data-anchor-id="introduction-3-4-paragraphs-usually-4"><strong>Introduction (3-4 paragraphs, usually 4)</strong></h2>
<p><strong>First paragraph</strong></p>
<p>Logic</p>
<ul>
<li><p>Attention grabbing opening sentence often times with an impressive statistic from the literature.</p></li>
<li><p>Each subsequent sentence gets more specific, narrowing to the topic of the paper.&nbsp;</p></li>
<li><p>The last sentence should introduce the gap in the literature.&nbsp;</p></li>
</ul>
<p>Example&nbsp;</p>
<p>At an estimated 69 million cases annually, traumatic brain injury (TBI) is a devastating global health pathology with a growing burden of disease. This burden disproportionately occurs in low- and middle income countries (LMICs), where the incidence of TBI is nearly 3 times the incidence in high-income countries (HICs). In sub-Saharan Africa (SSA), an estimated 801 people per 100,000 suffer TBI, with in-hospital mortality rates as high as 47% for severe TBI. In HICs, neurosurgical interventions have been shown to prevent morbidity and mortality in certain patients with TBI. However, in SSA, a region with an estimated 1 neurosurgeon per 9 million people, hospitals must balance limited surgical capacity with expansive clinical need. This demands investigation of the surgical impact on TBI outcomes, which can then support triage and surgical intervention decisions. Despite the need, the impact of surgery on TBI outcomes remains unexplored in low-resource settings.&nbsp;</p>
<p><strong>Second and third paragraph</strong></p>
<p>Logic</p>
<ul>
<li><p>The second and the third paragraph should leave your reader with sufficient context/understanding from the literature to understand the gap your paper will address.&nbsp;&nbsp;</p></li>
<li><p>Goal is to summarize the relevant existing literature to get the reader up to speed on the topic of interest.</p></li>
<li><p>As in the first paragraph, start broad and gradually get more specific with each subsequent sentence.&nbsp;</p></li>
<li><p>If possible, the last sentence in the second and third paragraph should segue into the next paragraph and introduce a gap in the literature justifying the need for your study.&nbsp;</p></li>
<li><p>Similar to paragraph two, the third paragraph should summarize the relevant existing literature to get the reader up to speed on the topic of interest. Often, there are two concepts that need to be introduced.&nbsp;</p></li>
</ul>
<p>Example&nbsp;</p>
<p>One major cause of in-hospital death for patients with TBI is secondary brain injury resulting from increased intracranial pressure. Neurosurgical decompression, including craniectomies and craniotomies, can relieve elevated intracranial pressure and prevent disability and death in certain TBI patients. TBI morbidity and mortality in SSA remains high due in part to limited neurosurgical resources and a TBI burden that exceeds capacity. In a comparison study, patients with a severe TBI in LMICs had more than twice the odds of death compared to patients in HICs. TBI surveillance registries from the SSA countries of Tanzania, Malawi, Uganda, and Ethiopia reported mortality rates of 47%, 41%, 26%, and 21%, respectively, for severe TBI. The causes of these mortality rates are multifactorial, including the prehospital and inpatient care settings. Although prehospital quality data in low resource settings are scarce, the availability of quality inpatient TBI registries from LMICs invites exploration of in-hospital care for patients with TBI in SSA.&nbsp;</p>
<p>A survival analysis performed using a Cox regression model is a powerful statistical technique to quantify the association between a treatment and outcome for two groups. For TBI, this technique has potential to measure associations between in-hospital clinical management (e.g., surgical intervention) and outcomes. As of 2010, there were only 12 papers examining TBI management in non–high-income settings, only 1 of which was from a low-income country. Despite a recent increase in published data on TBI management and outcomes in LMICs, there are no previous studies applying survival analyses to inpatient TBI outcomes data.</p>
<p><strong>Fourth paragraph</strong></p>
<p>Logic</p>
<ul>
<li><p>State the objective of the study; can be one or two sentences to state the primary and secondary objectives.&nbsp;</p></li>
<li><p>This paragraph can be shorter than the first three.&nbsp;</p></li>
</ul>
<p>Example&nbsp;</p>
<p>TBI outcomes data from an area of the world where trauma is an endemic disease can help plan interventions to improve TBI management. This study’s objective was to assess the outcomes of TBI patients at a tertiary referral center in Moshi, Tanzania. Specifically, we wanted to determine if TBI patients receiving surgery had better outcomes than TBI patients not receiving surgery and whether this differs with severity of injury. A greater understanding of the impact of surgery by TBI severity, particularly in a resource-scarce setting, can guide the prioritization of limited resources.</p>
</section>
<section id="methods" class="level2">
<h2 class="anchored" data-anchor-id="methods"><strong>Methods</strong></h2>
<p>Find the relevant guide from the equator network for the particular study - <a href="https://www.equator-network.org/" class="uri">https://www.equator-network.org/</a>&nbsp;</p>
<p>Mention that we used the “xyz” guideline (E.g. We used the STROBE guidelines for this study).&nbsp;</p>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results"><strong>Results</strong></h2>
<ul>
<li><p>Often best to start writing the results of a paper first and including the figures of interest. From the results section, the other sections of writing will flow easier.&nbsp;</p></li>
<li><p>Results typically have 1-3 Tables and 1-3 figures.</p></li>
<li><p><strong>Fight the urge to interpret the findings. This section is purely objective reporting of the study’s findings.</strong>&nbsp;</p></li>
<li><p>Please refer to the respective method in the GEMINI Toolbox for detailed&nbsp;</p></li>
</ul>
</section>
<section id="discussion" class="level2">
<h2 class="anchored" data-anchor-id="discussion"><strong>Discussion</strong></h2>
<p><strong>First paragraph</strong></p>
<p>Logic</p>
<ul>
<li><p>The first sentence says why this paper is AWESOME.</p></li>
<li><p>The next two to three sentences, at a high level, should highlight some major findings of the paper.&nbsp;</p></li>
<li><p>For the last sentence, think of the two-three (usually three) key findings from your paper. The last sentence will introduce the two or three topics you will expand on in the next couple paragraphs (similar to a thesis statement).&nbsp;</p></li>
</ul>
<p>Example</p>
<p>This study is the first analysis of acute TBI outcomes performed using a survival analysis in an LMIC and is one of the largest single-center studies on TBI outcome. Approximately one-quarter of the 2502 patients in our study received surgery for TBI; those who did had a lower hazard for poor outcome than those who did not. To varying degrees, we observed a benefit of surgery for all TBI severities. Surgical intervention was associated with the greatest improvement in outcomes for moderate TBI, followed by mild and severe TBI. The fully adjusted models revealed variables significantly associated with both poor and good outcome. This study leveraged advanced statistical methods and a robust data set from an LMIC to investigate the association of surgery with acute TBI outcomes and how that association changes according to TBI severity.</p>
<p><strong>Second, third, and forth paragraph</strong></p>
<ul>
<li><p>Expand upon the ideas introduced in the last sentence of the first paragraph of the discussion.</p></li>
<li><p>Specifically, discuss the finding from your paper and how that compares with other similar findings in the literature.</p></li>
<li><p>Cite other relevant papers here and “discuss” how your study is similar/different.&nbsp;</p></li>
</ul>
</section>
<section id="limitations" class="level2">
<h2 class="anchored" data-anchor-id="limitations"><strong>Limitations</strong></h2>
<p>Logic</p>
<ul>
<li><p>Example limitations range from sample size, sample selection, data limitations, response rates, short-comings to method/analysis used, etc.</p></li>
<li><p>Always have this section and be thoughtful about the limitations.&nbsp;</p></li>
<li><p>This section shows humility, no study is perfect.&nbsp;</p></li>
<li><p>Reviewers will appreciate you highlighting efforts made to partially mitigate limitations.&nbsp;&nbsp;</p></li>
</ul>
<p>Example</p>
<p>A robust statistical analysis of registry data from a low resource setting needs careful consideration of limitations. First, the decision to operate or not is influenced by factors that may also contribute to the patient outcome. For example, a patient may not receive surgery due to major comorbidities or other negative prognostic indicators. As a result, a patient suitable for surgery may be better positioned to have a good outcome. To mitigate this limitation, we used the data available to control for predictor of outcome (e.g., GCS score, age). Also, previous research in similar contexts of care has found that limited resources may be focused on more severely injured patients. The TBI registry used in this study did not include the GCS score at the time of surgery because this information was not always readily available to the research team. The type of surgery was also not documented in the database; however, the general surgery staff endorsed performing mostly burr holes and some hemicraniectomies/craniotomies. The registry included fewer patients who suffered severe and moderate TBI than those with mild injuries. The smaller sample size limited our ability to draw inferences from the survival analyses at later HDs. Other than the admission GCS score, we did not have data on the injury itself (e.g., CT results) to understand the severity of the TBI. We also did not have information on other injuries that might have caused poor outcomes. Finally, we did not have patient outcomes data past hospitalization due to the limited postdischarge contact and care in this clinical setting. This limited our analysis to in-hospital outcomes only.</p>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions"><strong>Conclusions</strong></h2>
<p>Logic</p>
<ul>
<li><p>Least important section, 3-4 sentences that are recycles, reworded text from earlier in the paper.</p></li>
<li><p>We sought out to do xyz, we found that xyz, we hope that xyyz helps encourage others or future work should investigate xyz.&nbsp;</p></li>
</ul>
<p>Example</p>
<p>A detailed understanding of TBI in-hospital outcomes in a low-resource setting is needed to support prudent use of limited, life-saving resources. This paper provides an analysis of surgical management and outcomes data from a tertiary referral center in Moshi, Tanzania. Surgical intervention improved outcomes for all patients with mild, moderate, and severe TBI. The positive impact of surgery to improve outcomes, however, was greatest for patients with moderate and mild TBI. Future research should investigate which patients with TBI are the best candidates for surgery and what factors contribute to clinical deterioration for patients with longer hospital stays, especially in the low-resource setting.</p>
</section>
<section id="guidelines" class="level2">
<h2 class="anchored" data-anchor-id="guidelines"><strong>Guidelines</strong></h2>
<ul>
<li><p><a href="https://drive.google.com/file/d/1k4R7fb0VsG8PUK9Mov7B3tjuxBq9ld5Q/view?usp=sharing" class="uri">https://drive.google.com/file/d/1k4R7fb0VsG8PUK9Mov7B3tjuxBq9ld5Q/view?usp=sharing</a></p>
<ul>
<li>Detailed and well written how-to for scientific writing.&nbsp;</li>
</ul></li>
</ul>
</section>
<section id="example-papers" class="level2">
<h2 class="anchored" data-anchor-id="example-papers"><strong>Example papers</strong></h2>
<ul>
<li><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7133756/" class="uri">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7133756/</a></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>